#include "Constructor.h"

#include "../../Classes/CBloonsTD5Game.h"

namespace Patcher
{
    namespace Patches
    {
        namespace CBloonsTD5Game
        {
			uintptr_t Constructor::funcOriginal = 0;
            Classes::CBloonsTD5Game* __fastcall cb_hook(Classes::CBloonsTD5Game* gameInstance) {
                std::cout << "Gameinstance created: " << gameInstance << std::endl;
               	Classes::CBloonsTD5Game* result = PLH::FnCast(Constructor::funcOriginal, cb_hook)(gameInstance);
				return result;
            }

			Constructor::Constructor() : IPatch("CBloonsTD5Game::Constructor") {
				this->AddSignature(new SigInfo(new std::string("55 8B EC 6A ?? 68 ?? ?? ?? ?? 64 ?? ?? ?? ?? ?? 50 83 EC ?? 53 56 57 A1 34 ?? ?? ?? 33 C5 50 8D ?? ?? ?? A3 ?? ?? ?? ?? 8B F1 ?? 75 ?? E8 ?? ?? ?? ?? ?? 45 ?? ?? ?? ?? ?? ?? 86"), 0)); //3.32 (21758)
				this->AddSignature(new SigInfo(new std::string("55 8B EC 6A ?? 68 ?? ?? ?? ?? 64 ?? ?? ?? ?? ?? 50 51 56 A1 34 ?? ?? ?? 33 C5 50 8D ?? ?? ?? A3 ?? ?? ?? ?? 8B F1 ?? 75 ?? E8 ?? ?? ?? ?? ?? 45 ?? ?? ?? ?? ?? ?? 86 ?? ?? ?? ?? ?? ?? ?? ?? ?? 86 ?? ?? ?? ?? ?? ?? ?? ?? ?? 86 ?? ?? ?? ?? ?? ?? ?? ?? ?? 86 ?? ?? ?? ?? ?? ?? ?? ?? ?? 86"), 0)); //3.28 (21607)
			}

            auto Constructor::Apply() -> bool
            {
				return this->AutoPatch(cb_hook, &funcOriginal);
            }
        }
    }
}